import { WalletClient } from 'viem';

/**
 * Wallet metadata describing wallet properties and capabilities.
 */
interface WalletMetadata {
    id?: string | null;
    address?: string | null;
    chain?: string | null;
    chainType?: string | null;
    provider?: string | null;
    accountId?: string | null;
    label?: string | null;
    caip2?: string | null;
}
/**
 * Interface for signing challenge messages used in wallet authentication.
 */
interface ChallengeSigner {
    signChallenge(challenge: {
        id: string;
        credential_id?: string | null;
        payload?: unknown;
        payload_hash?: string | null;
        nonce: string;
        scopes?: string[];
        issued_at: string | Date;
        expires_at: string | Date;
        server_signature?: string | null;
    }): Promise<string>;
}
/**
 * Core wallet connector interface that handles wallet operations and challenge signing.
 */
interface WalletConnector extends ChallengeSigner {
    getWalletMetadata(): Promise<WalletMetadata | null>;
    supportsCaip2?(caip2: string): boolean | Promise<boolean>;
    getAddress?(): Promise<string | null>;
    getCapabilities?(): WalletCapabilities | null | undefined;
    getSigner?(): Promise<LocalEoaSigner | null>;
    getWalletClient?<TClient = unknown>(): Promise<TClient | null>;
}
/**
 * Optional capabilities a wallet connector can expose beyond the base surface.
 * `signer` indicates the connector can provide a `LocalEoaSigner`.
 * `walletClient` indicates the connector can provide a contract-ready wallet client (e.g., viem).
 */
type WalletCapability = 'signer' | 'walletClient';
type WalletCapabilities = Partial<Record<WalletCapability, true>>;
/**
 * Options for configuring local wallet metadata.
 */
interface LocalWalletMetadataOptions {
    address?: string | null;
    caip2?: string | null;
    chain?: string | null;
    chainType?: string | null;
    provider?: string | null;
    label?: string | null;
    walletClient?: LocalWalletClientConfig | null;
}
interface LocalWalletClientConfig {
    rpcUrl?: string | null;
    chainId?: number | null;
    chainName?: string | null;
    nativeCurrency?: {
        name: string;
        symbol: string;
        decimals: number;
    } | null;
}
/**
 * Local wallet configuration using a private key.
 */
type LocalWalletOptions = LocalWalletMetadataOptions & {
    type: 'local';
    privateKey: string;
};
/**
 * Wallet configuration using a custom wallet client.
 * A wallet client is a viem WalletClient that can sign messages and send transactions.
 * This enables browser wallets (e.g., thirdweb) that use eth_sendTransaction instead of eth_signTransaction.
 */
type SignerWalletOptions = LocalWalletMetadataOptions & {
    type: 'signer';
    walletClient: WalletClient;
};
/**
 * Configuration for Lucid wallet connector (server-orchestrated wallet).
 */
interface LucidWalletOptions {
    type: 'lucid';
    baseUrl: string;
    agentRef: string;
    fetch?: (input: RequestInfo | URL, init?: RequestInit) => Promise<Response>;
    headers?: HeadersInit;
    accessToken?: string | null;
    authorizationContext?: Record<string, unknown>;
}
/**
 * Configuration for thirdweb Engine server wallet connector.
 */
interface ThirdwebWalletOptions {
    type: 'thirdweb';
    secretKey: string;
    clientId?: string;
    walletLabel: string;
    chainId: number;
    address?: string | null;
    caip2?: string | null;
    chain?: string | null;
    chainType?: string | null;
    label?: string | null;
}
/**
 * Configuration for an agent wallet. Can be local (with private key), signer (with custom signer), Lucid (server-orchestrated), or thirdweb.
 */
type AgentWalletConfig = LocalWalletOptions | SignerWalletOptions | LucidWalletOptions | ThirdwebWalletOptions;
/**
 * Configuration for a developer wallet. Can be local (with private key) or signer (with wallet client).
 */
type DeveloperWalletConfig = (LocalWalletMetadataOptions & {
    type: 'local';
    privateKey: string;
}) | SignerWalletOptions;
/**
 * Configuration for agent and developer wallets.
 */
type WalletsConfig = {
    agent?: AgentWalletConfig;
    developer?: DeveloperWalletConfig;
};
/**
 * Interface for signing messages and transactions with an EOA (Externally Owned Account) wallet.
 */
interface LocalEoaSigner {
    signMessage(message: string | Uint8Array): Promise<string>;
    signTypedData?(payload: {
        domain: Record<string, unknown>;
        primaryType: string;
        types: Record<string, Array<{
            name: string;
            type: string;
        }>>;
        message: Record<string, unknown>;
    }): Promise<string>;
    signTransaction?(transaction: {
        to?: `0x${string}` | null;
        value?: bigint;
        data?: `0x${string}`;
        gas?: bigint;
        gasPrice?: bigint;
        nonce?: number;
        chainId?: number;
    }): Promise<`0x${string}`>;
    getAddress?(): Promise<string | null>;
}
/**
 * Challenge structure used for wallet authentication and authorization.
 */
interface AgentChallenge {
    id: string;
    credential_id?: string | null;
    payload?: unknown;
    payload_hash?: string | null;
    nonce: string;
    scopes?: string[];
    issued_at: string | Date;
    expires_at: string | Date;
    server_signature?: string | null;
}
/**
 * Response containing an agent challenge for wallet authentication.
 */
interface AgentChallengeResponse {
    challenge: AgentChallenge;
}
/**
 * EIP-712 typed data payload for structured message signing.
 */
type TypedDataPayload = {
    domain: Record<string, unknown>;
    primaryType: string;
    types: Record<string, Array<{
        name: string;
        type: string;
    }>>;
    message: Record<string, unknown>;
};
/**
 * Function type for executing HTTP fetch requests.
 */
type FetchExecutor = (input: RequestInfo | URL, init?: RequestInit) => Promise<Response>;
/**
 * Type of agent wallet implementation.
 */
type AgentWalletKind = 'local' | 'signer' | 'lucid' | 'thirdweb';
/**
 * Type of developer wallet implementation.
 * Developer wallets can be local (private key-based) or signer (custom signer).
 */
type DeveloperWalletKind = 'local' | 'signer';
/**
 * Handle to an agent wallet instance with its connector and optional access token management.
 * Agent wallets can be either local or Lucid (server-orchestrated).
 */
interface AgentWalletHandle {
    kind: AgentWalletKind;
    connector: WalletConnector;
    setAccessToken?(token: string | null): void;
}
/**
 * Handle to a developer wallet instance.
 * Developer wallets can be local (private key-based) or signer (custom signer).
 */
interface DeveloperWalletHandle {
    kind: DeveloperWalletKind;
    connector: WalletConnector;
}
/**
 * Wallets runtime type.
 * Returned by AgentRuntime.wallets when wallets are configured.
 */
type WalletsRuntime = {
    agent?: AgentWalletHandle;
    developer?: DeveloperWalletHandle;
} | undefined;

export type { AgentChallenge, AgentChallengeResponse, AgentWalletConfig, AgentWalletHandle, AgentWalletKind, ChallengeSigner, DeveloperWalletConfig, DeveloperWalletHandle, DeveloperWalletKind, FetchExecutor, LocalEoaSigner, LocalWalletClientConfig, LocalWalletMetadataOptions, LocalWalletOptions, LucidWalletOptions, SignerWalletOptions, ThirdwebWalletOptions, TypedDataPayload, WalletCapabilities, WalletCapability, WalletConnector, WalletMetadata, WalletsConfig, WalletsRuntime };
