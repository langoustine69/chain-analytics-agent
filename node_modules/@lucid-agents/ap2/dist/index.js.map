{"version":3,"sources":["../src/runtime.ts","../src/types.ts","../src/manifest.ts","../src/extension.ts"],"names":[],"mappings":";AAMO,SAAS,iBAAiB,MAAA,EAA4C;AAC3E,EAAA,IAAI,CAAC,MAAA,EAAQ;AACX,IAAA,OAAO,MAAA;AAAA,EACT;AAEA,EAAA,OAAO;AAAA,IACL;AAAA,GACF;AACF;;;ACgHO,IAAM,iBAAA,GAAoB;;;ACrH1B,SAAS,sBAAA,CACd,MACA,SAAA,EAC0B;AAC1B,EAAA,IAAI,CAAC,SAAA,CAAU,KAAA,EAAO,MAAA,EAAQ;AAC5B,IAAA,OAAO,IAAA;AAAA,EACT;AAEA,EAAA,MAAM,CAAC,SAAA,EAAW,GAAG,SAAS,IAAI,SAAA,CAAU,KAAA;AAC5C,EAAA,IAAI,CAAC,SAAA,EAAW;AACd,IAAA,MAAM,IAAI,MAAM,2CAA2C,CAAA;AAAA,EAC7D;AAEA,EAAA,MAAM,KAAA,GAAiC,CAAC,SAAA,EAAW,GAAG,SAAS,CAAA;AAC/D,EAAA,MAAM,SAAA,GAAoC;AAAA,IACxC,GAAA,EAAK,iBAAA;AAAA,IACL,WAAA,EAAa,UAAU,WAAA,IAAe,+BAAA;AAAA,IACtC,QAAA,EAAU,SAAA,CAAU,QAAA,IAAY,KAAA,CAAM,SAAS,UAAU,CAAA;AAAA,IACzD,MAAA,EAAQ,EAAE,KAAA;AAAM,GAClB;AAEA,EAAA,MAAM,QAAA,GAAW,IAAA,CAAK,YAAA,EAAc,UAAA,IAAc,EAAC;AACnD,EAAA,MAAM,aAAa,QAAA,CAAS,MAAA;AAAA,IAC1B,CAAA,GAAA,KAAO,EAAE,KAAA,IAAS,GAAA,IAAO,IAAI,GAAA,KAAQ,iBAAA;AAAA,GACvC;AAEA,EAAA,MAAM,YAAA,GAAkC;AAAA,IACtC,GAAG,IAAA,CAAK,YAAA;AAAA,IACR,UAAA,EAAY,CAAC,GAAG,UAAA,EAAY,SAAS;AAAA,GACvC;AAEA,EAAA,OAAO;AAAA,IACL,GAAG,IAAA;AAAA,IACH;AAAA,GACF;AACF;;;ACjCO,SAAS,IAAI,OAAA,EAAsD;AACxE,EAAA,IAAI,UAAA;AAEJ,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,KAAA;AAAA,IACN,MAAM,GAAA,EAAyC;AAE7C,MAAA,IAAI,OAAA,EAAS;AACX,QAAA,UAAA,GAAa,iBAAiB,OAAO,CAAA;AACrC,QAAA,OAAO,EAAE,KAAK,UAAA,EAAW;AAAA,MAC3B;AAEA,MAAA,OAAO,EAAE,KAAK,MAAA,EAAU;AAAA,IAC1B,CAAA;AAAA,IACA,eAAA,CACE,MACA,OAAA,EAC0B;AAE1B,MAAA,IAAI,YAAY,MAAA,EAAQ;AACtB,QAAA,OAAO,sBAAA,CAAuB,IAAA,EAAM,UAAA,CAAW,MAAM,CAAA;AAAA,MACvD;AACA,MAAA,OAAO,IAAA;AAAA,IACT;AAAA,GACF;AACF","file":"index.js","sourcesContent":["import type { AP2Config, AP2Runtime } from '@lucid-agents/types/ap2';\n\n/**\n * Creates AP2 runtime from configuration.\n * Returns undefined if no config provided.\n */\nexport function createAP2Runtime(config?: AP2Config): AP2Runtime | undefined {\n  if (!config) {\n    return undefined;\n  }\n\n  return {\n    config,\n  };\n}\n\n","// AP2 (Agent Payments Protocol) typings and constants.\n// These mirror the published PYDantic models so TypeScript agents can share\n// the same shapes when constructing mandates or AgentCard extensions.\n\nexport const CONTACT_ADDRESS_DATA_KEY = 'contact_picker.ContactAddress' as const;\n\nexport type ContactAddress = {\n  city?: string | null;\n  country?: string | null;\n  dependent_locality?: string | null;\n  organization?: string | null;\n  phone_number?: string | null;\n  postal_code?: string | null;\n  recipient?: string | null;\n  region?: string | null;\n  sorting_code?: string | null;\n  address_line?: string[] | null;\n};\n\nexport const PAYMENT_METHOD_DATA_KEY = 'payment_request.PaymentMethodData' as const;\n\nexport type PaymentCurrencyAmount = {\n  currency: string;\n  value: number;\n};\n\nexport type PaymentItem = {\n  label: string;\n  amount: PaymentCurrencyAmount;\n  pending?: boolean | null;\n  refund_period?: number;\n};\n\nexport type PaymentShippingOption = {\n  id: string;\n  label: string;\n  amount: PaymentCurrencyAmount;\n  selected?: boolean | null;\n};\n\nexport type PaymentOptions = {\n  request_payer_name?: boolean | null;\n  request_payer_email?: boolean | null;\n  request_payer_phone?: boolean | null;\n  request_shipping?: boolean | null;\n  shipping_type?: 'shipping' | 'delivery' | 'pickup' | null;\n};\n\nexport type PaymentMethodData = {\n  supported_methods: string;\n  data?: Record<string, unknown>;\n};\n\nexport type PaymentDetailsModifier = {\n  supported_methods: string;\n  total?: PaymentItem;\n  additional_display_items?: PaymentItem[];\n  data?: unknown;\n};\n\nexport type PaymentDetailsInit = {\n  id: string;\n  display_items: PaymentItem[];\n  shipping_options?: PaymentShippingOption[];\n  modifiers?: PaymentDetailsModifier[];\n  total: PaymentItem;\n};\n\nexport type PaymentRequest = {\n  method_data: PaymentMethodData[];\n  details: PaymentDetailsInit;\n  options?: PaymentOptions;\n  shipping_address?: ContactAddress;\n};\n\nexport type PaymentResponse = {\n  request_id: string;\n  method_name: string;\n  details?: Record<string, unknown>;\n  shipping_address?: ContactAddress;\n  shipping_option?: PaymentShippingOption;\n  payer_name?: string | null;\n  payer_email?: string | null;\n  payer_phone?: string | null;\n};\n\nexport const INTENT_MANDATE_DATA_KEY = 'ap2.mandates.IntentMandate' as const;\nexport const CART_MANDATE_DATA_KEY = 'ap2.mandates.CartMandate' as const;\nexport const PAYMENT_MANDATE_DATA_KEY = 'ap2.mandates.PaymentMandate' as const;\n\nexport type IntentMandate = {\n  user_cart_confirmation_required: boolean;\n  natural_language_description: string;\n  merchants?: string[] | null;\n  skus?: string[] | null;\n  requires_refundability?: boolean | null;\n  intent_expiry: string;\n};\n\nexport type CartContents = {\n  id: string;\n  user_cart_confirmation_required: boolean;\n  payment_request: PaymentRequest;\n  cart_expiry: string;\n  merchant_name: string;\n};\n\nexport type CartMandate = {\n  contents: CartContents;\n  merchant_authorization?: string | null;\n};\n\nexport type PaymentMandateContents = {\n  payment_mandate_id: string;\n  payment_details_id: string;\n  payment_details_total: PaymentItem;\n  payment_response: PaymentResponse;\n  merchant_agent: string;\n  timestamp: string;\n};\n\nexport type PaymentMandate = {\n  payment_mandate_contents: PaymentMandateContents;\n  user_authorization?: string | null;\n};\n\nexport const AP2_EXTENSION_URI = 'https://github.com/google-agentic-commerce/ap2/tree/v0.1' as const;\nexport type { AP2Config, AP2ExtensionDescriptor, AP2ExtensionParams, AP2Role } from '@lucid-agents/types/ap2';\n\n","import type { AgentCardWithEntrypoints, AgentCapabilities } from '@lucid-agents/types/a2a';\nimport type { AP2Config, AP2ExtensionDescriptor, AP2Role } from '@lucid-agents/types/ap2';\n\nimport { AP2_EXTENSION_URI } from './types';\n\n/**\n * Creates a new Agent Card with AP2 extension added.\n * Immutable - returns new card, doesn't mutate input.\n */\nexport function createAgentCardWithAP2(\n  card: AgentCardWithEntrypoints,\n  ap2Config: AP2Config\n): AgentCardWithEntrypoints {\n  if (!ap2Config.roles?.length) {\n    return card;\n  }\n\n  const [firstRole, ...restRoles] = ap2Config.roles;\n  if (!firstRole) {\n    throw new Error('AP2 roles must contain at least one entry');\n  }\n\n  const roles: [AP2Role, ...AP2Role[]] = [firstRole, ...restRoles];\n  const extension: AP2ExtensionDescriptor = {\n    uri: AP2_EXTENSION_URI,\n    description: ap2Config.description ?? 'Agent Payments Protocol (AP2)',\n    required: ap2Config.required ?? roles.includes('merchant'),\n    params: { roles },\n  };\n\n  const existing = card.capabilities?.extensions ?? [];\n  const withoutAp2 = existing.filter(\n    ext => !('uri' in ext && ext.uri === AP2_EXTENSION_URI)\n  );\n\n  const capabilities: AgentCapabilities = {\n    ...card.capabilities,\n    extensions: [...withoutAp2, extension],\n  };\n\n  return {\n    ...card,\n    capabilities,\n  };\n}\n\n","import type {\n  AgentRuntime,\n  BuildContext,\n  Extension,\n} from '@lucid-agents/types/core';\nimport type { AgentCardWithEntrypoints } from '@lucid-agents/types/a2a';\nimport type { AP2Config, AP2Runtime } from '@lucid-agents/types/ap2';\n\nimport { createAgentCardWithAP2 } from './manifest';\nimport { createAP2Runtime } from './runtime';\n\nexport function ap2(options?: AP2Config): Extension<{ ap2?: AP2Runtime }> {\n  let ap2Runtime: AP2Runtime | undefined;\n\n  return {\n    name: 'ap2',\n    build(ctx: BuildContext): { ap2?: AP2Runtime } {\n      // Only create runtime if explicit config provided\n      if (options) {\n        ap2Runtime = createAP2Runtime(options);\n        return { ap2: ap2Runtime };\n      }\n      // No auto-detection - require explicit configuration\n      return { ap2: undefined };\n    },\n    onManifestBuild(\n      card: AgentCardWithEntrypoints,\n      runtime: AgentRuntime\n    ): AgentCardWithEntrypoints {\n      // Only add AP2 extension if explicitly configured\n      if (ap2Runtime?.config) {\n        return createAgentCardWithAP2(card, ap2Runtime.config);\n      }\n      return card;\n    },\n  };\n}\n"]}