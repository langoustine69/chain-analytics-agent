{"version":3,"sources":["../src/card.ts","../src/client.ts","../src/runtime.ts","../src/extension.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import type {\n  AgentCard,\n  AgentCardWithEntrypoints,\n  AgentCapabilities,\n  AgentMeta,\n  Manifest,\n} from '@lucid-agents/types/a2a';\nimport type { EntrypointDef } from '@lucid-agents/types/core';\nimport type { FetchFunction } from '@lucid-agents/types/http';\nimport type { BuildAgentCardOptions } from '@lucid-agents/types/a2a';\nimport { z } from 'zod';\n\n/**\n * Builds base Agent Card following A2A protocol.\n * Does NOT include payments, identity, or AP2 extensions.\n * Does NOT add pricing to entrypoints.\n */\nexport function buildAgentCard({\n  meta,\n  registry,\n  origin,\n}: BuildAgentCardOptions): AgentCardWithEntrypoints {\n  const entrypoints: Manifest['entrypoints'] = {};\n  const entrypointList: EntrypointDef[] = Array.from(registry);\n  const anyStreaming = entrypointList.some(e => Boolean(e.stream));\n\n  for (const e of entrypointList) {\n    const manifestEntry: Manifest['entrypoints'][string] = {\n      description: e.description,\n      streaming: Boolean(e.stream),\n      input_schema: e.input ? z.toJSONSchema(e.input) : undefined,\n      output_schema: e.output ? z.toJSONSchema(e.output) : undefined,\n    };\n    // Note: pricing is NOT added here - that's payments package responsibility\n    entrypoints[e.key] = manifestEntry;\n  }\n\n  const defaultInputModes = ['application/json'];\n  const defaultOutputModes = ['application/json', 'text/plain'];\n  const skills = entrypointList.map(e => ({\n    id: e.key,\n    name: e.key,\n    description: e.description,\n    inputModes: defaultInputModes,\n    outputModes: defaultOutputModes,\n    streaming: Boolean(e.stream),\n    x_input_schema: e.input ? z.toJSONSchema(e.input) : undefined,\n    x_output_schema: e.output ? z.toJSONSchema(e.output) : undefined,\n  }));\n\n  const capabilities: AgentCapabilities = {\n    streaming: anyStreaming,\n    pushNotifications: false,\n    stateTransitionHistory: true,\n  };\n\n  const card: AgentCardWithEntrypoints = {\n    protocolVersion: '1.0',\n    name: meta.name,\n    description: meta.description,\n    url: origin.endsWith('/') ? origin : `${origin}/`,\n    supportedInterfaces: [\n      {\n        url: origin.endsWith('/') ? origin : `${origin}/`,\n        protocolBinding: 'HTTP+JSON',\n      },\n    ],\n    version: meta.version,\n    provider: undefined,\n    capabilities,\n    defaultInputModes,\n    defaultOutputModes,\n    skills,\n    supportsAuthenticatedExtendedCard: false,\n    entrypoints,\n  };\n\n  return card;\n}\n\n/**\n * Fetches Agent Card from another agent's well-known endpoint.\n * Tries multiple well-known paths for compatibility with different agent implementations.\n *\n * Per ERC-8004, the endpoint may already be a full URL to the agent card.\n * Per A2A spec section 5.3, the recommended discovery path is /.well-known/agent-card.json.\n */\nexport async function fetchAgentCard(\n  baseUrl: string,\n  fetchImpl?: FetchFunction\n): Promise<AgentCard> {\n  const card = await fetchAgentCardInternal(baseUrl, fetchImpl);\n  const { entrypoints, ...agentCard } = card;\n  return agentCard;\n}\n\nexport async function fetchAgentCardWithEntrypoints(\n  baseUrl: string,\n  fetchImpl?: FetchFunction\n): Promise<AgentCardWithEntrypoints> {\n  return fetchAgentCardInternal(baseUrl, fetchImpl);\n}\n\n/**\n * Parses and validates Agent Card JSON structure.\n */\nexport function parseAgentCard(json: unknown): AgentCardWithEntrypoints {\n  if (!json || typeof json !== 'object') {\n    throw new Error('Agent Card must be an object');\n  }\n\n  const obj = json as Record<string, unknown>;\n\n  if (typeof obj.name !== 'string') {\n    throw new Error('Agent Card must have a name field');\n  }\n\n  return {\n    name: obj.name,\n    description:\n      typeof obj.description === 'string' ? obj.description : undefined,\n    url: typeof obj.url === 'string' ? obj.url : undefined,\n    version: typeof obj.version === 'string' ? obj.version : undefined,\n    provider: obj.provider as AgentCardWithEntrypoints['provider'],\n    capabilities: obj.capabilities as AgentCardWithEntrypoints['capabilities'],\n    defaultInputModes: Array.isArray(obj.defaultInputModes)\n      ? (obj.defaultInputModes as string[])\n      : undefined,\n    defaultOutputModes: Array.isArray(obj.defaultOutputModes)\n      ? (obj.defaultOutputModes as string[])\n      : undefined,\n    skills: Array.isArray(obj.skills)\n      ? (obj.skills as AgentCardWithEntrypoints['skills'])\n      : undefined,\n    supportsAuthenticatedExtendedCard:\n      typeof obj.supportsAuthenticatedExtendedCard === 'boolean'\n        ? obj.supportsAuthenticatedExtendedCard\n        : undefined,\n    entrypoints: (obj.entrypoints as Manifest['entrypoints']) ?? {},\n    payments: Array.isArray(obj.payments)\n      ? (obj.payments as AgentCardWithEntrypoints['payments'])\n      : undefined,\n    registrations: Array.isArray(obj.registrations)\n      ? (obj.registrations as AgentCardWithEntrypoints['registrations'])\n      : undefined,\n    trustModels: Array.isArray(obj.trustModels)\n      ? (obj.trustModels as AgentCardWithEntrypoints['trustModels'])\n      : undefined,\n    ValidationRequestsURI:\n      typeof obj.ValidationRequestsURI === 'string'\n        ? obj.ValidationRequestsURI\n        : undefined,\n    ValidationResponsesURI:\n      typeof obj.ValidationResponsesURI === 'string'\n        ? obj.ValidationResponsesURI\n        : undefined,\n    FeedbackDataURI:\n      typeof obj.FeedbackDataURI === 'string' ? obj.FeedbackDataURI : undefined,\n  };\n}\n\n/**\n * Finds a skill by ID in an Agent Card.\n */\nexport function findSkill(\n  card: AgentCard,\n  skillId: string\n): AgentCard['skills'][number] | undefined {\n  return card.skills?.find(skill => skill.id === skillId);\n}\n\n/**\n * Checks if an agent supports a specific capability.\n *\n * @param card - Agent card\n * @param capability - Capability to check ('streaming' | 'pushNotifications' | 'stateTransitionHistory')\n * @returns true if the capability is supported\n */\nexport function hasCapability(\n  card: AgentCard | null,\n  capability: keyof AgentCapabilities\n): boolean {\n  if (!card?.capabilities) {\n    return false;\n  }\n  return Boolean(card.capabilities[capability]);\n}\n\n/**\n * Checks if an agent has a specific skill tag.\n *\n * @param card - Agent card\n * @param tag - Skill tag to check\n * @returns true if the agent has the tag\n */\nexport function hasSkillTag(card: AgentCard | null, tag: string): boolean {\n  if (!card?.skills) {\n    return false;\n  }\n  return card.skills.some(skill =>\n    skill.tags?.some(t => t.toLowerCase() === tag.toLowerCase())\n  );\n}\n\n/**\n * Checks if an agent supports payments.\n *\n * @param card - Agent card\n * @returns true if the agent has payment methods configured\n */\nexport function supportsPayments(card: AgentCard | null): boolean {\n  return Boolean(card?.payments && card.payments.length > 0);\n}\n\n/**\n * Checks if an agent has trust/identity information.\n *\n * @param card - Agent card\n * @returns true if the agent has trust models or registrations\n */\nexport function hasTrustInfo(card: AgentCard | null): boolean {\n  return Boolean(card?.trustModels?.length || card?.registrations?.length);\n}\n\n/**\n * Fetches Agent Card from another agent's well-known endpoint.\n * Tries multiple well-known paths for compatibility with different agent implementations.\n *\n * Per ERC-8004, the endpoint may already be a full URL to the agent card.\n * Per A2A spec section 5.3, the recommended discovery path is /.well-known/agent-card.json.\n */\nasync function fetchAgentCardInternal(\n  baseUrl: string,\n  fetchImpl?: FetchFunction\n): Promise<AgentCardWithEntrypoints> {\n  const fetchFn = fetchImpl ?? globalThis.fetch;\n  if (!fetchFn) {\n    throw new Error('fetch is not available');\n  }\n\n  const normalizedBase = baseUrl.replace(/\\/$/, '');\n  const agentcardUrls: string[] = [];\n\n  if (baseUrl.startsWith('http://') || baseUrl.startsWith('https://')) {\n    agentcardUrls.push(baseUrl);\n  }\n\n  agentcardUrls.push(`${normalizedBase}/.well-known/agent-card.json`);\n  agentcardUrls.push(`${normalizedBase}/.well-known/agent.json`);\n  agentcardUrls.push(`${normalizedBase}/agentcard.json`);\n\n  let lastError: Error | null = null;\n\n  for (const agentcardUrl of agentcardUrls) {\n    try {\n      let url: URL;\n      try {\n        url = new URL(agentcardUrl);\n      } catch {\n        url = new URL(agentcardUrl, baseUrl);\n      }\n\n      const response = await fetchFn(url.toString());\n\n      if (response.ok) {\n        const json = await response.json();\n        return parseAgentCard(json);\n      }\n\n      if (response.status !== 404) {\n        lastError = new Error(\n          `Failed to fetch Agent Card: ${response.status} ${response.statusText}`\n        );\n      }\n    } catch (error) {\n      if (!lastError) {\n        lastError =\n          error instanceof Error\n            ? error\n            : new Error('Failed to fetch Agent Card');\n      }\n    }\n  }\n\n  throw (\n    lastError ||\n    new Error(\n      `Failed to fetch Agent Card from any well-known path. Tried: ${agentcardUrls.join(', ')}`\n    )\n  );\n}\n","import type { FetchFunction } from '@lucid-agents/types/http';\nimport type { AgentCard } from '@lucid-agents/types/a2a';\nimport type {\n  InvokeAgentResult,\n  StreamEmit,\n  SendMessageRequest,\n  SendMessageResponse,\n  Task,\n  TaskUpdateEvent,\n  A2AClient,\n  ListTasksRequest,\n  ListTasksResponse,\n  CancelTaskRequest,\n  CancelTaskResponse,\n} from '@lucid-agents/types/a2a';\n\nimport { fetchAgentCard, findSkill } from './card';\n\n/**\n * Invokes an agent's entrypoint using the Agent Card.\n */\nexport async function invokeAgent(\n  card: AgentCard,\n  skillId: string,\n  input: unknown,\n  fetchImpl?: FetchFunction\n): Promise<InvokeAgentResult> {\n  const skill = findSkill(card, skillId);\n  if (!skill) {\n    throw new Error(`Skill \"${skillId}\" not found in Agent Card`);\n  }\n\n  const baseUrl = card.url;\n  if (!baseUrl) {\n    throw new Error('Agent Card missing url field');\n  }\n\n  const fetchFn = fetchImpl ?? globalThis.fetch;\n  if (!fetchFn) {\n    throw new Error('fetch is not available');\n  }\n\n  const url = new URL(`/entrypoints/${skillId}/invoke`, baseUrl);\n  const response = await fetchFn(url.toString(), {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({ input }),\n  });\n\n  if (!response.ok) {\n    throw new Error(\n      `Agent invocation failed: ${response.status} ${response.statusText}`\n    );\n  }\n\n  return (await response.json()) as InvokeAgentResult;\n}\n\n/**\n * Streams from an agent's entrypoint using the Agent Card.\n */\nexport async function streamAgent(\n  card: AgentCard,\n  skillId: string,\n  input: unknown,\n  emit: StreamEmit,\n  fetchImpl?: FetchFunction\n): Promise<void> {\n  const skill = findSkill(card, skillId);\n  if (!skill) {\n    throw new Error(`Skill \"${skillId}\" not found in Agent Card`);\n  }\n\n  const baseUrl = card.url;\n  if (!baseUrl) {\n    throw new Error('Agent Card missing url field');\n  }\n\n  const fetchFn = fetchImpl ?? globalThis.fetch;\n  if (!fetchFn) {\n    throw new Error('fetch is not available');\n  }\n\n  const url = new URL(`/entrypoints/${skillId}/stream`, baseUrl);\n  const response = await fetchFn(url.toString(), {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({ input }),\n  });\n\n  if (!response.ok) {\n    throw new Error(\n      `Agent stream failed: ${response.status} ${response.statusText}`\n    );\n  }\n\n  if (!response.body) {\n    throw new Error('Response body is null');\n  }\n\n  const reader = response.body.getReader();\n  const decoder = new TextDecoder();\n  let buffer = '';\n  let currentEvent: { type: string; data: string } | null = null;\n\n  try {\n    while (true) {\n      const { done, value } = await reader.read();\n      if (done) break;\n\n      buffer += decoder.decode(value, { stream: true });\n      const lines = buffer.split('\\n');\n      buffer = lines.pop() || '';\n\n      for (const line of lines) {\n        if (line.startsWith('event: ')) {\n          currentEvent = {\n            type: line.slice(7).trim(),\n            data: '',\n          };\n        } else if (line.startsWith('data: ')) {\n          if (currentEvent) {\n            currentEvent.data +=\n              (currentEvent.data ? '\\n' : '') + line.slice(6);\n          }\n        } else if (line === '' && currentEvent) {\n          try {\n            const data = currentEvent.data ? JSON.parse(currentEvent.data) : {};\n            await emit({ type: currentEvent.type, data });\n          } catch (error) {\n            // Ignore JSON parse errors for non-JSON data\n            await emit({ type: currentEvent.type, data: currentEvent.data });\n          }\n          currentEvent = null;\n        }\n      }\n    }\n\n    // Handle remaining buffer\n    if (buffer.trim() && currentEvent) {\n      try {\n        const data = currentEvent.data ? JSON.parse(currentEvent.data) : {};\n        await emit({ type: currentEvent.type, data });\n      } catch {\n        await emit({ type: currentEvent.type, data: currentEvent.data });\n      }\n    }\n  } finally {\n    reader.releaseLock();\n  }\n}\n\n/**\n * Convenience function that fetches an Agent Card and invokes an entrypoint.\n */\nexport async function fetchAndInvoke(\n  baseUrl: string,\n  skillId: string,\n  input: unknown,\n  fetchImpl?: FetchFunction\n): Promise<InvokeAgentResult> {\n  const card = await fetchAgentCard(baseUrl, fetchImpl);\n  return invokeAgent(card, skillId, input, fetchImpl);\n}\n\n/**\n * Sends a message to an agent using A2A task-based operations.\n * Creates a task and returns the taskId immediately.\n */\nexport async function sendMessage(\n  card: AgentCard,\n  skillId: string,\n  input: unknown,\n  fetchImpl?: FetchFunction,\n  options?: { contextId?: string; metadata?: Record<string, unknown> }\n): Promise<SendMessageResponse> {\n  const skill = findSkill(card, skillId);\n  if (!skill) {\n    throw new Error(`Skill \"${skillId}\" not found in Agent Card`);\n  }\n\n  const baseUrl = card.url;\n  if (!baseUrl) {\n    throw new Error('Agent Card missing url field');\n  }\n\n  const fetchFn = fetchImpl ?? globalThis.fetch;\n  if (!fetchFn) {\n    throw new Error('fetch is not available');\n  }\n\n  // Construct A2A SendMessageRequest format\n  const messageContent: SendMessageRequest['message']['content'] = {\n    text: typeof input === 'string' ? input : JSON.stringify(input),\n  };\n\n  const requestBody: SendMessageRequest = {\n    message: {\n      role: 'user',\n      content: messageContent,\n    },\n    skillId,\n    contextId: options?.contextId,\n    metadata: options?.metadata,\n  };\n\n  const url = new URL('/tasks', baseUrl);\n  const response = await fetchFn(url.toString(), {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify(requestBody),\n  });\n\n  if (!response.ok) {\n    throw new Error(\n      `Task creation failed: ${response.status} ${response.statusText}`\n    );\n  }\n\n  return (await response.json()) as SendMessageResponse;\n}\n\n/**\n * Gets the status of a task.\n */\nexport async function getTask(\n  card: AgentCard,\n  taskId: string,\n  fetchImpl?: FetchFunction\n): Promise<Task> {\n  const baseUrl = card.url;\n  if (!baseUrl) {\n    throw new Error('Agent Card missing url field');\n  }\n\n  const fetchFn = fetchImpl ?? globalThis.fetch;\n  if (!fetchFn) {\n    throw new Error('fetch is not available');\n  }\n\n  const url = new URL(`/tasks/${taskId}`, baseUrl);\n  const response = await fetchFn(url.toString(), {\n    method: 'GET',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(\n      `Failed to get task: ${response.status} ${response.statusText}`\n    );\n  }\n\n  return (await response.json()) as Task;\n}\n\n/**\n * Subscribes to task updates via SSE.\n */\nexport async function subscribeTask(\n  card: AgentCard,\n  taskId: string,\n  emit: (chunk: TaskUpdateEvent) => Promise<void> | void,\n  fetchImpl?: FetchFunction\n): Promise<void> {\n  const baseUrl = card.url;\n  if (!baseUrl) {\n    throw new Error('Agent Card missing url field');\n  }\n\n  const fetchFn = fetchImpl ?? globalThis.fetch;\n  if (!fetchFn) {\n    throw new Error('fetch is not available');\n  }\n\n  const url = new URL(`/tasks/${taskId}/subscribe`, baseUrl);\n  const response = await fetchFn(url.toString(), {\n    method: 'GET',\n    headers: {\n      Accept: 'text/event-stream',\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(\n      `Failed to subscribe to task: ${response.status} ${response.statusText}`\n    );\n  }\n\n  if (!response.body) {\n    throw new Error('Response body is null');\n  }\n\n  const reader = response.body.getReader();\n  const decoder = new TextDecoder();\n  let buffer = '';\n  let currentEvent: { type: string; data: string } | null = null;\n\n  try {\n    while (true) {\n      const { done, value } = await reader.read();\n      if (done) break;\n\n      buffer += decoder.decode(value, { stream: true });\n      const lines = buffer.split('\\n');\n      buffer = lines.pop() || '';\n\n      for (const line of lines) {\n        if (line.startsWith('event: ')) {\n          currentEvent = {\n            type: line.slice(7).trim(),\n            data: '',\n          };\n        } else if (line.startsWith('data: ')) {\n          if (currentEvent) {\n            currentEvent.data +=\n              (currentEvent.data ? '\\n' : '') + line.slice(6);\n          }\n        } else if (line === '' && currentEvent) {\n          try {\n            const data = currentEvent.data ? JSON.parse(currentEvent.data) : {};\n            await emit({ type: currentEvent.type, data } as TaskUpdateEvent);\n          } catch (error) {\n            // Ignore JSON parse errors for non-JSON data\n            await emit({\n              type: currentEvent.type,\n              data: {\n                taskId,\n                error: {\n                  code: 'parse_error',\n                  message: currentEvent.data || 'Failed to parse event data',\n                },\n              },\n            } as TaskUpdateEvent);\n          }\n          currentEvent = null;\n        }\n      }\n    }\n\n    // Handle remaining buffer\n    if (buffer.trim() && currentEvent) {\n      try {\n        const data = currentEvent.data ? JSON.parse(currentEvent.data) : {};\n        await emit({ type: currentEvent.type, data } as TaskUpdateEvent);\n      } catch {\n        await emit({\n          type: currentEvent.type,\n          data: {\n            taskId,\n            error: {\n              code: 'parse_error',\n              message: currentEvent.data || 'Failed to parse event data',\n            },\n          },\n        } as TaskUpdateEvent);\n      }\n    }\n  } finally {\n    reader.releaseLock();\n  }\n}\n\n/**\n * Convenience function that fetches an Agent Card and sends a message.\n */\nexport async function fetchAndSendMessage(\n  baseUrl: string,\n  skillId: string,\n  input: unknown,\n  fetchImpl?: FetchFunction\n): Promise<SendMessageResponse> {\n  const card = await fetchAgentCard(baseUrl, fetchImpl);\n  return sendMessage(card, skillId, input, fetchImpl);\n}\n\n/**\n * Lists tasks with optional filtering.\n */\nexport async function listTasks(\n  card: AgentCard,\n  filters?: ListTasksRequest,\n  fetchImpl?: FetchFunction\n): Promise<ListTasksResponse> {\n  const baseUrl = card.url;\n  if (!baseUrl) {\n    throw new Error('Agent Card missing url field');\n  }\n\n  const fetchFn = fetchImpl ?? globalThis.fetch;\n  if (!fetchFn) {\n    throw new Error('fetch is not available');\n  }\n\n  const url = new URL('/tasks', baseUrl);\n  if (filters?.contextId) url.searchParams.set('contextId', filters.contextId);\n  if (filters?.status) {\n    const statusArray = Array.isArray(filters.status)\n      ? filters.status\n      : [filters.status];\n    url.searchParams.set('status', statusArray.join(','));\n  }\n  if (filters?.limit) url.searchParams.set('limit', String(filters.limit));\n  if (filters?.offset) url.searchParams.set('offset', String(filters.offset));\n\n  const response = await fetchFn(url.toString(), {\n    method: 'GET',\n    headers: { 'Content-Type': 'application/json' },\n  });\n\n  if (!response.ok) {\n    throw new Error(\n      `Failed to list tasks: ${response.status} ${response.statusText}`\n    );\n  }\n\n  return (await response.json()) as ListTasksResponse;\n}\n\n/**\n * Cancels a running task.\n */\nexport async function cancelTask(\n  card: AgentCard,\n  taskId: string,\n  fetchImpl?: FetchFunction\n): Promise<Task> {\n  const baseUrl = card.url;\n  if (!baseUrl) {\n    throw new Error('Agent Card missing url field');\n  }\n\n  const fetchFn = fetchImpl ?? globalThis.fetch;\n  if (!fetchFn) {\n    throw new Error('fetch is not available');\n  }\n\n  const url = new URL(`/tasks/${taskId}/cancel`, baseUrl);\n  const response = await fetchFn(url.toString(), {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n  });\n\n  if (!response.ok) {\n    throw new Error(\n      `Failed to cancel task: ${response.status} ${response.statusText}`\n    );\n  }\n\n  return (await response.json()) as Task;\n}\n\n/**\n * Helper function to wait for a task to complete.\n * Polls task status until it's completed or failed.\n */\nexport async function waitForTask<TOutput = unknown>(\n  client: A2AClient,\n  card: AgentCard,\n  taskId: string,\n  maxWaitMs = 30000\n): Promise<Task<TOutput>> {\n  const startTime = Date.now();\n  while (Date.now() - startTime < maxWaitMs) {\n    const task = await client.getTask(card, taskId);\n    if (task.status === 'completed' || task.status === 'failed') {\n      return task as Task<TOutput>;\n    }\n    await new Promise(resolve => setTimeout(resolve, 100));\n  }\n  throw new Error(`Task ${taskId} did not complete within ${maxWaitMs}ms`);\n}\n","import type { AgentRuntime } from '@lucid-agents/types/core';\nimport type { FetchFunction } from '@lucid-agents/types/http';\nimport type {\n  A2ARuntime,\n  CreateA2ARuntimeOptions,\n} from '@lucid-agents/types/a2a';\n\nimport {\n  buildAgentCard,\n  fetchAgentCard,\n  fetchAgentCardWithEntrypoints,\n} from './card';\nimport {\n  invokeAgent,\n  streamAgent,\n  fetchAndInvoke,\n  sendMessage,\n  getTask,\n  subscribeTask,\n  fetchAndSendMessage,\n  listTasks,\n  cancelTask,\n} from './client';\n\n/**\n * Creates A2A runtime from an AgentRuntime.\n * Always returns a runtime (A2A is always available).\n */\nexport function createA2ARuntime(\n  runtime: AgentRuntime,\n  _options?: CreateA2ARuntimeOptions\n): A2ARuntime {\n  const a2aRuntime: A2ARuntime = {\n    buildCard(origin: string) {\n      const entrypoints = runtime.entrypoints.snapshot();\n      return buildAgentCard({\n        meta: runtime.agent.config.meta,\n        registry: entrypoints,\n        origin,\n      });\n    },\n\n    async fetchCard(baseUrl: string, fetchImpl?: FetchFunction) {\n      return fetchAgentCard(baseUrl, fetchImpl);\n    },\n\n    async fetchCardWithEntrypoints(\n      baseUrl: string,\n      fetchImpl?: FetchFunction\n    ) {\n      return fetchAgentCardWithEntrypoints(baseUrl, fetchImpl);\n    },\n\n    client: {\n      invoke: invokeAgent,\n      stream: streamAgent,\n      fetchAndInvoke,\n      sendMessage,\n      getTask,\n      subscribeTask,\n      fetchAndSendMessage,\n      listTasks,\n      cancelTask,\n    },\n  };\n\n  return a2aRuntime;\n}\n","import type {\n  AgentRuntime,\n  BuildContext,\n  Extension,\n} from '@lucid-agents/types/core';\nimport type { A2ARuntime } from '@lucid-agents/types/a2a';\n\nimport { createA2ARuntime } from './runtime';\n\nexport function a2a(): Extension<{ a2a: A2ARuntime }> {\n  return {\n    name: 'a2a',\n    build(_ctx: BuildContext): { a2a: A2ARuntime } {\n      // A2A runtime needs the full runtime, so we create it in onBuild\n      // Return placeholder - will be replaced in onBuild\n      return {\n        a2a: {} as A2ARuntime,\n      };\n    },\n    onBuild(runtime: AgentRuntime) {\n      const a2aRuntime = createA2ARuntime(runtime);\n      runtime.a2a = a2aRuntime;\n    },\n  };\n}\n"]}