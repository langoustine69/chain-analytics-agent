{"version":3,"sources":["../../src/axllm/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import {\n  createX402LLM,\n  type CreateX402LLMOptions,\n} from '@lucid-agents/payments';\nimport type { Hex } from 'viem';\n\nexport type AxLLMClientOptions = {\n  provider?: string;\n  model?: string;\n  apiKey?: string;\n  apiUrl?: string;\n  temperature?: number;\n  debug?: boolean;\n  env?: Record<string, string | undefined>;\n  client?: ReturnType<typeof createX402LLM>;\n  clientFactory?: () => ReturnType<typeof createX402LLM> | null;\n  x402?: CreateX402LLMOptions;\n  logger?: {\n    warn?: (message: string, error?: unknown) => void;\n  };\n};\n\nexport type AxLLMClient = {\n  ax: ReturnType<typeof createX402LLM> | null;\n  isConfigured(): boolean;\n};\n\nconst DEFAULT_PROVIDER = 'openai';\nconst DEFAULT_MODEL = 'gpt-5';\n\nexport function createAxLLMClient(\n  options: AxLLMClientOptions = {}\n): AxLLMClient {\n  const resolved = resolveOptions(options);\n  const logger = options.logger;\n\n  const axInstance = (() => {\n    if (options.client) return options.client;\n\n    const fromFactory = options.clientFactory?.();\n    if (fromFactory) return fromFactory;\n\n    try {\n      return createX402LLM(buildCreateOptions(resolved, options.x402));\n    } catch (error) {\n      logger?.warn?.(\n        `[agent-kit] failed to initialise Ax LLM client: ${\n          (error as Error).message\n        }`,\n        error\n      );\n      return null;\n    }\n  })();\n\n  return {\n    ax: axInstance,\n    isConfigured() {\n      return Boolean(axInstance);\n    },\n  };\n}\n\nfunction resolveOptions(options: AxLLMClientOptions) {\n  const env = readEnv(options.env);\n\n  const provider =\n    options.provider ??\n    env.AX_PROVIDER ??\n    env.AXLLM_PROVIDER ??\n    env.OPENAI_PROVIDER ??\n    DEFAULT_PROVIDER;\n\n  const model =\n    options.model ??\n    env.AX_MODEL ??\n    env.AXLLM_MODEL ??\n    env.OPENAI_MODEL ??\n    DEFAULT_MODEL;\n\n  const apiKey = options.apiKey ?? env.OPENAI_API_KEY;\n\n  const apiUrl =\n    options.apiUrl ?? env.AX_API_URL ?? env.AXLLM_API_URL ?? env.OPENAI_API_URL;\n\n  const temperature =\n    options.temperature ??\n    parseNumber(\n      env.AX_TEMPERATURE ?? env.AXLLM_TEMPERATURE ?? env.OPENAI_TEMPERATURE\n    );\n\n  const debug =\n    options.debug ?? parseBoolean(env.AX_DEBUG ?? env.AXLLM_DEBUG) ?? false;\n\n  return { provider, model, apiKey, apiUrl, temperature, debug };\n}\n\nfunction buildCreateOptions(\n  resolved: ReturnType<typeof resolveOptions>,\n  overrides: CreateX402LLMOptions | undefined\n): CreateX402LLMOptions {\n  const x402 = overrides ? { ...overrides } : {};\n  const aiOverrides = overrides?.ai ? { ...overrides.ai } : {};\n  const aiConfigOverrides =\n    aiOverrides.config && typeof aiOverrides.config === 'object'\n      ? { ...aiOverrides.config }\n      : undefined;\n  const aiOptionOverrides =\n    aiOverrides.options && typeof aiOverrides.options === 'object'\n      ? { ...aiOverrides.options }\n      : undefined;\n\n  const finalTemperature =\n    aiConfigOverrides && 'temperature' in aiConfigOverrides\n      ? aiConfigOverrides.temperature\n      : resolved.temperature;\n\n  const finalConfig = {\n    stream: false,\n    model: aiConfigOverrides?.model ?? x402.model ?? resolved.model,\n    ...(aiConfigOverrides ?? {}),\n    ...(finalTemperature !== undefined\n      ? { temperature: finalTemperature }\n      : {}),\n  };\n\n  const finalOptions = {\n    ...(aiOptionOverrides ?? {}),\n    ...(resolved.debug ? { debug: resolved.debug } : {}),\n  };\n\n  const apiKey =\n    aiOverrides.apiKey ??\n    resolved.apiKey ??\n    (typeof process !== 'undefined' ? process.env.OPENAI_API_KEY : undefined);\n\n  if (!apiKey) {\n    throw new Error(\n      '[agent-kit] createAxLLMClient requires an OpenAI API key (set apiKey or OPENAI_API_KEY)'\n    );\n  }\n\n  const name = aiOverrides.name ?? resolved.provider;\n  const apiURL = aiOverrides.apiURL ?? resolved.apiUrl;\n\n  const finalAi = {\n    ...aiOverrides,\n    name,\n    apiKey,\n    ...(apiURL ? { apiURL } : {}),\n    config: finalConfig,\n    options: finalOptions,\n  } as NonNullable<CreateX402LLMOptions['ai']>;\n\n  const createOptions: CreateX402LLMOptions = {\n    ...x402,\n    model: x402.model ?? resolved.model,\n    ai: finalAi,\n  };\n\n  if (!createOptions.account && !createOptions.privateKey) {\n    const envPrivateKey =\n      typeof process !== 'undefined'\n        ? (process.env.PRIVATE_KEY as Hex | undefined)\n        : undefined;\n    if (envPrivateKey) {\n      createOptions.privateKey = envPrivateKey;\n    }\n  }\n\n  return createOptions;\n}\n\nfunction readEnv(\n  env: Record<string, string | undefined> | undefined\n): Record<string, string | undefined> {\n  if (env) return env;\n  if (typeof process !== 'undefined' && process?.env) {\n    return process.env as Record<string, string | undefined>;\n  }\n  return {};\n}\n\nfunction parseBoolean(value: string | undefined): boolean | undefined {\n  if (value === undefined) return undefined;\n  if (value.trim() === '') return undefined;\n  return ['1', 'true', 'yes', 'on'].includes(value.toLowerCase());\n}\n\nfunction parseNumber(value: string | undefined): number | undefined {\n  if (value === undefined) return undefined;\n  const numeric = Number.parseFloat(value);\n  return Number.isFinite(numeric) ? numeric : undefined;\n}\n"]}